/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.3/userguide/java_library_plugin.html
 */

plugins {
	// Apply the java-library plugin to add support for Java Library
	id 'java-library'
	id "io.freefair.lombok" version "5.3.0"
	id 'maven-publish'
	id 'signing'
	id 'java'
}

repositories {
	// Use jcenter for resolving dependencies.
	// You can declare any Maven/Ivy/file repository here.
	jcenter()
}


sourceCompatibility = 1.8
targetCompatibility = 1.8

group = 'io.reliza'
version = '0.1.47-SNAPSHOT'

task changeVersion {
	doLast {
		if(project.hasProperty('newVersion')) {
			String s=buildFile.getText().replaceFirst("version = '$version'","version = '"+newVersion+"'")
			buildFile.setText(s)
		}
	}
}

ext.isReleaseVersion = !version.endsWith("SNAPSHOT")

if (!project.hasProperty("centralUser")) {
	ext.centralUser = 'test'
}
if (!project.hasProperty("centralPassword")) {
	ext.centralPassword = 'test'
}

java {
	withJavadocJar()
	withSourcesJar()
}

publishing {
	publications {
		relizaJavaClient(MavenPublication) {
			artifactId = 'reliza-java-client'
			from components.java
			pom {
				name = 'reliza-java-client'
				description = 'Java Client SDK for Reliza Hub'
				url = 'https://relizahub.com'
				licenses {
					license {
						name = 'MIT License'
						url = 'https://github.com/relizaio/reliza-java-client/blob/main/LICENSE'
					}
				}
				developers {
					developer {
						id = 'Xenogents'
						name = 'Rasa Rahnema'
						email = 'info@reliza.io'
					}
					developer {
						id = 'taleodor'
						name = 'Pavel Shukhman'
						email = 'info@reliza.io'
					}
				}
				scm {
					connection = 'scm:git:git://github.com/relizaio/reliza-java-client.git'
					developerConnection = 'scm:git:ssh://github.com/relizaio/reliza-java-client.git'
					url = 'https://github.com/relizaio/reliza-java-client/'
				}
			}
		}
	}
	
	repositories {
		maven {
			name = 'central'
			url = 'https://oss.sonatype.org/service/local/staging/deploy/maven2/'
			credentials {
				username "$centralUser"
				password "$centralPassword"
			}
		}
	}

}



tasks.withType(Sign) {
	onlyIf { isReleaseVersion }
}

signing {
	// required { !version.endsWith("SNAPSHOT") && gradle.taskGraph.hasTask("publish") }
	// def signingKeyId = findProperty("signingKeyId")
	def signingKey = GPG_SIGNING_KEY
	def signingPassword = GPG_SIGNING_PASSWORD
	useInMemoryPgpKeys(signingKey, signingPassword)
	sign publishing.publications.relizaJavaClient
}

dependencies {
	// This dependency is exported to consumers, that is to say found on their compile classpath.
	// api 'org.apache.commons:commons-math3:3.6.1'

	// This dependency is used internally, and not exposed to consumers on their own compile classpath.
	implementation 'com.google.guava:guava:28.2-jre'
	
	implementation 'com.squareup.retrofit2:retrofit:2.9.0'
	
	implementation 'com.squareup.retrofit2:converter-jackson:2.9.0'
	
	implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.9.4'
	
	implementation 'org.apache.logging.log4j:log4j-slf4j-impl:2.14.0'
	
	implementation 'org.apache.commons:commons-collections4:4.0'
	
	implementation 'org.apache.commons:commons-lang3:3.0'
	
	api 'commons-io:commons-io:2.8.0'
 
	// Use JUnit test framework
	testImplementation 'junit:junit:4.12'
}
